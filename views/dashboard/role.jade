extends _layout1
block pagecontent
    body.skin-blue
      include ./parts/top
      div.wrapper.row-offcanvas.row-offcanvas-left
            include ./parts/menu
            aside.right-side
              section.content-header
                h1  Yeni Role
                  small            
                ol.breadcrumb
                  li
                    a(href='#')
                      i.fa.fa-dashboard
                      |  Haftalık
                  |                         
                  li.active İçerik Ekle
              section.content
                .row
                  .col-md-11
                    #loading-example.box.box-danger
                      .box-header
                        // tools box
                        .pull-right.box-tools
                          button.btn.btn-danger.btn-sm(data-widget='collapse', data-toggle='tooltip', title='Collapse')
                            i.fa.fa-minus
                        // /. tools
                        i.fa.fa-user
                        h3.box-title 
                        br
                        br
                        br
                        .box-body.table-responsive
                          table#example1.table.table-bordered.table-striped
                            thead
                              tr
                                th(style="width:25px;") #
                                th İzin Adı
                                th Url
                                th Sayfa Adı
                                th İzin No
                            tbody.us
                            tfoot
                              tr
                                th #
                                th İzin Adı
                                th Url
                                th Sayfa Adı
                                th İzin No
                        // /.box-body
                      .box-footer
                        .row
                          .col-xs-4.text-center(style='border-right: 1px solid #f4f4f4')
                           input#rol_name.form-control(type='text', placeholder='Rol Adı Giriniz')
                          .col-xs-4.text-center(style='border-right: 1px solid #f4f4f4')
                       
                          .col-xs-4
                            a.pull-right.btn.btn-primary(href="javascript:save('role')") KAYDET
              section.content
                .row
                  .col-md-11
                    #loading-example.box.box-danger
                      .box-header
                        // tools box
                        .pull-right.box-tools
                          button.btn.btn-danger.btn-sm(data-widget='collapse', data-toggle='tooltip', title='Collapse')
                            i.fa.fa-minus
                        // /. tools
                        i.fa.fa-user
                        h3.box-title 
                        br
                        br
                        br
                        .box-body.table-responsive
                          table#example2.table.table-bordered.table-striped
                            thead
                              tr
                                th Rol Adı
                                th Ekli İzinler
                                th Ekli Kişiler
                                th #
                            tbody.role_list
                            tfoot
                              tr
                                th Rol Adı
                                th Ekli İzinler
                                th Ekli Kişiler
                                th #

  block scripts 
    script(src="/static/js/admin/plugins/datatables/jquery.dataTables.js" type="text/javascript")
    script(src="/static/js/admin/plugins/datatables/dataTables.bootstrap.js" type="text/javascript")
    script(type="text/javascript").
      var us_izin=[];
      $(document).ready(function(){
        getList();
      });
      function getList(){
        ////////////////////////////////izinlerin listelenmesi ////////////
        var us=0;
        $('.us').html("");
        JSON.parse('!{izinler}').forEach(function(kayit){
          us++;
          $('.us').append('<tr>'+
                              '<td><input id='+kayit.permission+' onclick="javascript:checkbox_change(\''+kayit.permission+'\')" type="checkbox" ></div></td>'+
                              '<td>'+kayit.name+'</td>'+
                              '<td>'+kayit.url+'</td>'+
                              '<td>'+kayit.pagename+'</td>'+
                              '<td>'+kayit.permission+'</td>'+
                            '</tr>');
           if(us==JSON.parse('!{izinler}').length)
              $('#example1').dataTable();
        });
        //////////////////////////////////////////////////////////////////////////
        /////////////////////////////rollerin listelenmesi ////////////////////////////
        postData('/ajax/getList',{model_list:["role"]},function(retVal){
          console.log(retVal);
          $('.role_list').html("");
          retVal.role.forEach(function(kayit){
            console.log(kayit);
            $('.role_list').append('<tr>'+
                                      '<td>'+kayit.role_name+'</td>'+
                                      '<td>'+kayit.permission.join()+'</td>'+
                                      '<td>'+kayit.eklenen_kisiler.join()+'</td>'+
                                      '<td><a href="javascript:sil(\''+kayit._id+'\',\'role\',\'getList\')"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a></td>'+
                                    '</tr>');
          });
        });
      }
      function checkbox_change(izin){
        if($('#'+izin).is(':checked')==true)
           us_izin.push(izin);
        else{
          var sira=us_izin.indexOf(izin);
          us_izin.splice(sira,1);
        }
        console.log(us_izin);
      }